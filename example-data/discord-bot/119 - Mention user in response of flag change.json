{"RepoName":"discord-bot","RepoDescription":"A discord bot for the Wise Old Man project.","RepoUrl":"https://api.github.com/repos/wise-old-man/discord-bot","RepoReadmeFilename":"README.md","RepoReadmeContent":"\u003Cdiv align = \u0022center\u0022\u003E\n\n![Wise Old Man Discord Bot](https://user-images.githubusercontent.com/3278148/86964409-ec5f2880-c15d-11ea-84bf-8b484d60afd2.png)\n\n\uD83D\uDD17 [www.bot.wiseoldman.net](https://bot.wiseoldman.net/)\n\nTrack your Old School Runescape clan\u2019s progress from your own Discord server.\n\n![MIT license](https://img.shields.io/github/license/wise-old-man/wise-old-man) ![Bot repo](https://img.shields.io/badge/wise%20old%20man-discord%20bot-blue)\n\nThe Wise Old Man is an app that tracks your Old School Runescape player progress. Built on top of the OSRS hiscores, it allows you to keep track of your gains, participate in group competitions, collect achievements and much more.\n\nThis repository is an extention of the core project, a Discord Bot to server as a secondary user interface.\n\n[Website](https://bot.wiseoldman.net/) |\n[Discord](https://discord.gg/Ky5vNt2) |\n[Patreon](https://www.patreon.com/wiseoldman)\n\n\u003C/div\u003E\n\n\u003Cbr /\u003E\n\n## \uD83D\uDC6A Related projects\n\n- [Core Repository (API/Webapp)](https://github.com/wise-old-man/wise-old-man)\n- [Discord Bot Landing Page](https://github.com/wise-old-man/bot.wiseoldman.net)\n\n\u003Cbr /\u003E\n\n## \uD83D\uDCDA Technologies\n\nThis project is built using Discord.js, Sequelize and Express.\n\n\u003Cbr /\u003E\n\n## \uD83D\uDCAC Suggestions and bugs\n\nHave a suggestion or a bug to report? [Click here to create a issue](https://github.com/wise-old-man/discord-bot/issues)\n\nHave something else you\u0027d like to discuss? [Join us on discord](https://discord.gg/Ky5vNt2)\n\n\u003Cbr /\u003E\n","Filenames":[".dockerignore",".eslintignore",".eslintrc",".gitattributes",".github/workflows/deploy.yml",".prettierrc",".sequelizerc","Dockerfile","LICENSE","README.md","docker-compose.yml","package.json","src/api/handler.ts","src/api/index.ts","src/api/modules/competitions.ts","src/api/modules/groups.ts","src/api/modules/names.ts","src/api/modules/players.ts","src/api/modules/snapshots.ts","src/api/types.ts","src/api/utils.ts","src/bot.ts","src/commands/CommandError.ts","src/commands/CustomCommands.ts","src/commands/instances/config/ConfigChannelPreference.ts","src/commands/instances/config/ConfigDefaultChannel.ts","src/commands/instances/config/ConfigGroup.ts","src/commands/instances/config/ConfigPrefix.ts","src/commands/instances/general/Help.ts","src/commands/instances/group/GroupCompetition.ts","src/commands/instances/group/GroupCompetitions.ts","src/commands/instances/group/GroupDetails.ts","src/commands/instances/group/GroupGained.ts","src/commands/instances/group/GroupHiscores.ts","src/commands/instances/group/GroupMembers.ts","src/commands/instances/group/GroupRecords.ts","src/commands/instances/index.ts","src/commands/instances/moderation/ApproveNameChange.ts","src/commands/instances/moderation/DenyNameChange.ts","src/commands/instances/moderation/ResetCompetitionCode.ts","src/commands/instances/moderation/ResetGroupCode.ts","src/commands/instances/moderation/ReviewNameChange.ts","src/commands/instances/moderation/VerifyGroup.ts","src/commands/instances/player/PlayerAchievements.ts","src/commands/instances/player/PlayerActivities.ts","src/commands/instances/player/PlayerBosses.ts","src/commands/instances/player/PlayerEfficiency.ts","src/commands/instances/player/PlayerGained.ts","src/commands/instances/player/PlayerSetFlag.ts","src/commands/instances/player/PlayerSetUsername.ts","src/commands/instances/player/PlayerStats.ts","src/commands/instances/player/UpdatePlayer.ts","src/commands/parser.ts","src/commands/router.ts","src/config.ts","src/database/config.ts","src/database/index.ts","src/database/migrations/20200616003302-create-guild-configs-table.ts","src/database/migrations/20200709182151-add-player-alias.ts","src/database/migrations/20210306142806-create-channel-preferences-table.ts","src/database/models/Alias.ts","src/database/models/ChannelPreference.ts","src/database/models/Server.ts","src/database/services/alias.ts","src/database/services/channelPreferences.ts","src/database/services/server.ts","src/events/instances/CompetitionCreated.ts","src/events/instances/CompetitionEnded.ts","src/events/instances/CompetitionEnding.ts","src/events/instances/CompetitionStarted.ts","src/events/instances/CompetitionStarting.ts","src/events/instances/MemberAchievements.ts","src/events/instances/MemberHardcoreDied.ts","src/events/instances/MemberNameChanged.ts","src/events/instances/MembersJoined.ts","src/events/instances/MembersLeft.ts","src/events/instances/index.ts","src/events/router.ts","src/index.ts","src/types.ts","src/utils/broadcast.ts","src/utils/dates.ts","src/utils/discord.ts","src/utils/flags.ts","src/utils/index.ts","src/utils/levels.ts","src/utils/metrics.ts","src/utils/rendering.ts","src/utils/strings.ts","tsconfig.json","wait-for-it.sh"],"PrNumber":119,"PrTitle":"Mention user in response of flag change","PrBody":"![image](https://user-images.githubusercontent.com/5983417/135636027-d4536e7b-017d-4380-ae52-fa7df13adb68.png)\r\nCloses #118 ","PrModifiedFiles":[{"Status":"modified","FileName":"src/commands/instances/player/PlayerSetFlag.ts","Contents":"import { MessageEmbed } from \u0027discord.js\u0027;\nimport { updateCountry } from \u0027../../../api/modules/players\u0027;\nimport config from \u0027../../../config\u0027;\nimport { Command, ParsedMessage } from \u0027../../../types\u0027;\nimport { countryCodeEmoji, emojiCountryCode, getEmoji } from \u0027../../../utils\u0027;\nimport CommandError from \u0027../../CommandError\u0027;\n\nclass PlayerSetFlag implements Command {\n  name: string;\n  template: string;\n\n  constructor() {\n    this.name = \u0027Set player flag (country)\u0027;\n    this.template = \u0027!setflag {country_code} {username}\u0027;\n  }\n\n  activated(message: ParsedMessage) {\n    return message.command === \u0027setflag\u0027 \u0026\u0026 message.args.length \u003E= 2;\n  }\n\n  async execute(message: ParsedMessage) {\n    const username = this.getUsername(message);\n    const countryCode = this.getCountryCode(message);\n\n    const response = { message: \u0027\u0027, isError: false };\n\n    if (\n      message.sourceMessage?.guild?.id !== config.discord.guildId ||\n      message.sourceMessage?.channel?.id !== config.discord.channels.flags\n    ) {\n      throw new CommandError(\n        \u0027This command only works in the **#change-flag** channel of the official Wise Old Man discord server.\\\n        You can join at https://wiseoldman.net/discord\u0027\n      );\n    }\n\n    try {\n      const result = await updateCountry(username, countryCode);\n      response.message = result.message;\n      response.isError = false;\n    } catch (e) {\n      // The API\u0027s error message references country name, and this command\n      // is restricted to country codes (for now), so let\u0027s hide that part of the message\n      response.message = e.response?.data?.message?.replace(\u0027 or name\u0027, \u0027\u0027) || \u0027Failed to update flag.\u0027;\n      response.isError = true;\n    }\n\n    const embed = new MessageEmbed()\n      .setColor(response.isError ? config.visuals.red : config.visuals.green)\n      .setTitle(\n        response.isError\n          ? \u0060${getEmoji(\u0027error\u0027)} Failed to update flag\u0060\n          : \u0060${countryCodeEmoji(countryCode)} Player flag updated!\u0060\n      )\n      .setDescription(response.message)\n      .addFields([\n        { name: \u0027Username\u0027, value: username },\n        { name: \u0027Country Code:\u0027, value: countryCode }\n      ]);\n\n    if (response.isError) {\n      embed.setFooter(\u0027The correct command format is: !setflag {username} {country_code}\u0027);\n    }\n\n    message.respond(embed);\n  }\n\n  getUsername(message: ParsedMessage): string {\n    const usernameArgs = message.args.slice(0, message.args.length - 1);\n    return usernameArgs.join(\u0027 \u0027);\n  }\n\n  getCountryCode(message: ParsedMessage): string {\n    const code = message.args[message.args.length - 1];\n\n    if (code.length === 4) {\n      return emojiCountryCode(code);\n    }\n\n    return code.toUpperCase();\n  }\n}\n\nexport default new PlayerSetFlag();\n"}],"GitDiff":"diff --git a/src/commands/instances/player/PlayerSetFlag.ts b/src/commands/instances/player/PlayerSetFlag.ts\n--- a/src/commands/instances/player/PlayerSetFlag.ts\n\u002B\u002B\u002B b/src/commands/instances/player/PlayerSetFlag.ts\n@@ -52,7 \u002B52,10 @@ class PlayerSetFlag implements Command {\n           ? \u0060${getEmoji(\u0027error\u0027)} Failed to update flag\u0060\n           : \u0060${countryCodeEmoji(countryCode)} Player flag updated!\u0060\n       )\n-      .setDescription(response.message)\n\u002B      .setDescription(\n\u002B        !response.isError\n\u002B          ? \u0060${message.sourceMessage.author.toString()} changed \\\u0060${username}\\\u0060\u0027s country to ${response.message.match(\u0027\\\\: (.*?) \\\\(.{2}\\\\)\u0027)?.[1]}\u0060\n\u002B          : response.message)\n       .addFields([\n         { name: \u0027Username\u0027, value: username },\n         { name: \u0027Country Code:\u0027, value: countryCode }\n"}